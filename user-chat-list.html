<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Elérhető szakik – SzakiChat</title>

<style>
    body { font-family: Arial, sans-serif; background:#f2f2f2; margin:0; }
    header {
        background:#007aff; color:white; text-align:center;
        padding:18px; font-size:22px; font-weight:bold;
    }
    .box {
        background:white; max-width:480px; margin:20px auto;
        padding:18px; border-radius:12px;
        box-shadow:0 4px 14px rgba(0,0,0,0.1);
    }
    .szaki {
        border:1px solid #ddd; border-radius:10px;
        padding:12px; margin:10px 0; background:#fafafa;
    }
    .btn {
        background:#007aff; color:white; border:none;
        padding:10px 14px; border-radius:8px; cursor:pointer;
        margin-top:10px; width:100%;
        font-size:16px;
    }
    .btn:disabled {
        background:#ccc; cursor:not-allowed;
    }
    .small { font-size:14px; color:#555; margin-top:6px; }
    .online { color:green; font-weight:bold; }
</style>
</head>

<body>

<header>Elérhető szakik</header>

<div class="box" id="titleBox"></div>

<div class="box">
    <h3>Budapesti szakik:</h3>
    <div id="szakiList"></div>
</div>

<script>
// ▶️ 1. Betöltjük a user adatait
const name = localStorage.getItem("user_name") || "Ismeretlen";
const job  = localStorage.getItem("user_job") || "szakembert";
const city = localStorage.getItem("user_city") || "valahol";

// ▶️ 2. Kiírás a felületre
document.getElementById("titleBox").innerHTML =
    `<b>${name}</b> ${job.toLowerCase()} keres <b>${city}</b> területén.<br><br>
     Válassz ki maximum <b>3 szakembert</b>, akikkel szeretnél beszélni.`;

// ▶️ 3. DEMO szakik (később Firestore-ból jönnek)
const szakik = [
    { id: "szaki1", name: "Kis Lajos", profession: "Festő", city: "Budapest", online: true },
    { id: "szaki2", name: "Nagy Zsolt", profession: "Festő", city: "Budapest", online: false },
    { id: "szaki3", name: "Mészáros Dani", profession: "Burkoló", city: "Budapest", online: true },
    { id: "szaki4", name: "Varga Jani", profession: "Festő", city: "Budapest", online: false }
];

// ▶️ 4. Maximum 3 chat
let activeChats = JSON.parse(localStorage.getItem("active_chats") || "[]");

// ▶️ 5. Lista megjelenítése
function renderList() {
    const box = document.getElementById("szakiList");
    box.innerHTML = "";

    szakik.forEach(s => {
        const alreadyChosen = activeChats.includes(s.id);
        const limitReached = activeChats.length >= 3;

        box.innerHTML += `
            <div class="szaki">
                <b>${s.name}</b> — ${s.profession}<br>
                <span class="small">Város: ${s.city}</span><br>
                <span class="small ${s.online ? "online" : ""}">
                    ${s.online ? "Online" : "Offline"}
                </span><br><br>

                <button class="btn"
                        onclick="startChat('${s.id}')"
                        ${alreadyChosen || limitReached ? "disabled" : ""}>
                    ${alreadyChosen ? "Már beszélgettek" : "Chat indítása"}
                </button>
            </div>
        `;
    });
}

renderList();

// ▶️ 6. Chat indítása
function startChat(szakiId) {

    if (!activeChats.includes(szakiId)) {
        activeChats.push(szakiId);
        if (activeChats.length > 3) activeChats.length = 3;
        localStorage.setItem("active_chats", JSON.stringify(activeChats));
    }

    // Mentjük, kivel beszél a user
    localStorage.setItem("chat_with", szakiId);

    // Tovább a chatformra
    window.location.href = "user-chat.html";
}

</script>

</body>
</html>
